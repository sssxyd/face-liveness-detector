# å±å¹•è½®å»“æ£€æµ‹ç®—æ³•æ–‡æ¡£

## ç›®å½•
1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æ ¸å¿ƒåŸç†](#æ ¸å¿ƒåŸç†)
3. [ç®—æ³•è¯¦è§£](#ç®—æ³•è¯¦è§£)
4. [å‚æ•°é…ç½®](#å‚æ•°é…ç½®)
5. [æ€§èƒ½ç‰¹æ€§](#æ€§èƒ½ç‰¹æ€§)
6. [é›†æˆæŒ‡å—](#é›†æˆæŒ‡å—)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¦‚è¿°

### é—®é¢˜å®šä¹‰

å±å¹•è½®å»“æ£€æµ‹ï¼ˆScreen Corners Contour Detectionï¼‰æ˜¯ä¸€ç§å¿«é€Ÿçš„å•å¸§å›¾åƒæ£€æµ‹æ–¹æ³•ï¼Œç”¨äºè¯†åˆ«æ‘„åƒå¤´æ˜¯å¦åœ¨æ‹æ‘„å¦ä¸€ä¸ªå±å¹•è®¾å¤‡ï¼ˆæ‰‹æœºã€å¹³æ¿ã€æ˜¾ç¤ºå™¨ç­‰ï¼‰ã€‚å½“æ”»å‡»è€…ä½¿ç”¨ä¸€ä¸ªè®¾å¤‡çš„å±å¹•æ’­æ”¾äººè„¸è§†é¢‘/ç…§ç‰‡ï¼Œç„¶åç”¨å¦ä¸€ä¸ªè®¾å¤‡çš„æ‘„åƒå¤´æ‹æ‘„æ—¶ï¼Œå›¾åƒä¸­ä¼šå‡ºç°æ˜æ˜¾çš„å±å¹•è¾¹ç•Œè½®å»“ã€‚

### æ£€æµ‹ç›®æ ‡

é€šè¿‡æ£€æµ‹å›¾åƒä¸­çš„**çŸ©å½¢è¾¹ç•Œè½®å»“**ï¼Œè¯†åˆ«ä»¥ä¸‹æƒ…å†µï¼š
- **çœŸå®äººè„¸**ï¼šæ— æ˜æ˜¾çŸ©å½¢è¾¹ç•Œï¼ŒèƒŒæ™¯è‡ªç„¶
- **å±å¹•æ‹æ‘„**ï¼šå­˜åœ¨æ¸…æ™°çš„çŸ©å½¢å±å¹•è¾¹æ¡†
- **æ‰‹æœºå±å¹•**ï¼šé€šå¸¸æœ‰4ä¸ªç›´è§’å’Œæ˜æ˜¾çš„çŸ©å½¢è¾¹ç•Œ
- **å¹³æ¿/æ˜¾ç¤ºå™¨**ï¼šè¾ƒå¤§çš„çŸ©å½¢è½®å»“

### æŠ€æœ¯äº®ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å¿«é€Ÿæ£€æµ‹** | å•å¸§å¤„ç†ï¼Œ~10-20ms |
| **ç›´è§‚ç‰¹å¾** | åŸºäºå±å¹•ç‰©ç†è¾¹ç•Œï¼Œä¸ä¾èµ–å¤æ‚æ¨¡å‹ |
| **ä½è¯¯æŠ¥** | ä¸¥æ ¼é˜ˆå€¼è®¾è®¡ï¼ˆç½®ä¿¡åº¦>0.75ï¼‰ |
| **è½»é‡çº§** | ä»…éœ€OpenCVï¼Œæ— é¢å¤–ä¾èµ– |
| **äº’è¡¥æ€§å¼º** | å¯ä¸å…¶ä»–æ£€æµ‹æ–¹æ³•ç»„åˆä½¿ç”¨ |

---

## æ ¸å¿ƒåŸç†

### ä¸ºä»€ä¹ˆå±å¹•ä¼šç•™ä¸‹çŸ©å½¢è½®å»“ï¼Ÿ

å½“ç”¨æ‘„åƒå¤´æ‹æ‘„å±å¹•æ—¶ï¼Œå±å¹•è¾¹ç•Œä¼šäº§ç”Ÿæ˜æ˜¾çš„å¯¹æ¯”ï¼š

#### 1. å±å¹•è¾¹æ¡†ç‰¹å¾

**ç‰©ç†ç‰¹æ€§**ï¼š
- å±å¹•è¾¹ç¼˜æ˜¯ç›´çº¿
- å±å¹•ä¸èƒŒæ™¯äº®åº¦/é¢œè‰²æœ‰æ˜æ˜¾å·®å¼‚
- å½¢æˆæ¸…æ™°çš„çŸ©å½¢è½®å»“

**å¯è§†åŒ–å¯¹æ¯”**ï¼š

```
çœŸå®äººè„¸åœºæ™¯ï¼š              å±å¹•æ‹æ‘„åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è‡ªç„¶èƒŒæ™¯      â”‚       â”‚  èƒŒæ™¯           â”‚
â”‚  â•­â”€â”€â”€â”€â”€â•®        â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ‘¤  â”‚        â”‚       â”‚ â”‚ğŸ“± å±å¹•   â”‚    â”‚
â”‚  â”‚äººè„¸ â”‚        â”‚       â”‚ â”‚  ğŸ‘¤      â”‚    â”‚
â”‚  â•°â”€â”€â”€â”€â”€â•¯        â”‚       â”‚ â”‚  äººè„¸    â”‚    â”‚
â”‚   æ— çŸ©å½¢è¾¹ç•Œ    â”‚       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  è¾¹ç•Œæ¨¡ç³Š/ä¸è§„åˆ™             æ¸…æ™°çŸ©å½¢è¾¹ç•Œ âš ï¸
```

#### 2. è¾¹ç¼˜æ£€æµ‹åŸç†

**Cannyè¾¹ç¼˜æ£€æµ‹**ï¼š
- æ£€æµ‹å›¾åƒä¸­äº®åº¦å‰§çƒˆå˜åŒ–çš„ä½ç½®
- å±å¹•è¾¹ç•Œï¼šå±å¹•å†…ï¼ˆäº®ï¼‰â†’ è¾¹æ¡†ï¼ˆæš—ï¼‰â†’ èƒŒæ™¯
- äº§ç”Ÿå¼ºè¾¹ç¼˜å“åº”

```
äº®åº¦åˆ†å¸ƒç¤ºä¾‹ï¼š

çœŸå®åœºæ™¯ï¼š                  å±å¹•æ‹æ‘„ï¼š
äº®åº¦                        äº®åº¦
 â–²                           â–²
 â”‚  â•±â•²â•±â•²                    â”‚     â”Œâ”€â”€â”€â”€â”
 â”‚ â•±    â•²                   â”‚     â”‚    â”‚ â† å±å¹•å†…
 â”‚â•±      â•²                  â”‚  â”€â”€â”€â”˜    â””â”€â”€â”€ 
 â””â”€â”€â”€â”€â”€â”€â”€â”€â†’ ä½ç½®            â””â”€â”€â”€â”€â”€â”€â”€â”€â†’ ä½ç½®
   å¹³æ»‘æ¸å˜                    çªå˜è¾¹ç¼˜ âš ï¸
```

#### 3. è½®å»“å½¢çŠ¶ç‰¹å¾

**çŸ©å½¢æ£€æµ‹**ï¼š
- å±å¹•è½®å»“æ˜¯æ ‡å‡†çŸ©å½¢ï¼ˆ4ä¸ªé¡¶ç‚¹ï¼‰
- å¯¹è¾¹é•¿åº¦ç›¸ç­‰
- è§’åº¦æ¥è¿‘90åº¦

```
è½®å»“è¿‘ä¼¼åï¼š

çœŸå®åœºæ™¯è½®å»“ï¼š              å±å¹•è½®å»“ï¼š
   â•±â•²                      â”Œâ”€â”€â”€â”€â”€â”€â”
  â•±  â•²  â•±â•²                â”‚      â”‚
 â•±    â•²â•±  â•²               â”‚      â”‚
â•±          â•²              â””â”€â”€â”€â”€â”€â”€â”˜
ä¸è§„åˆ™å¤šè¾¹å½¢                æ ‡å‡†çŸ©å½¢ âš ï¸
```

---

## ç®—æ³•è¯¦è§£

### æ£€æµ‹æµç¨‹

```
è¾“å…¥ç°åº¦å›¾åƒ
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Cannyè¾¹ç¼˜æ£€æµ‹   â”‚
â”‚ - threshold1: 35        â”‚
â”‚ - threshold2: 110       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: è½®å»“æ£€æµ‹        â”‚
â”‚ - findContours()        â”‚
â”‚ - RETR_TREEæ¨¡å¼         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: è½®å»“ç­›é€‰        â”‚
â”‚ - é¢ç§¯ > 1200pxÂ²        â”‚
â”‚ - å¤šè¾¹å½¢è¿‘ä¼¼            â”‚
â”‚ - å››è¾¹å½¢åˆ¤å®š            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: çŸ©å½¢éªŒè¯        â”‚
â”‚ - å¯¹è¾¹é•¿åº¦æ¯”è¾ƒ          â”‚
â”‚ - å…è®¸è¯¯å·® Â±20%         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: ç½®ä¿¡åº¦è®¡ç®—      â”‚
â”‚ - è½®å»“æ•°é‡: 70%æƒé‡     â”‚
â”‚ - è¾¹ç•Œå æ¯”: 30%æƒé‡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
è¾“å‡ºæ£€æµ‹ç»“æœ
```

### Step 1: Cannyè¾¹ç¼˜æ£€æµ‹

**ç›®çš„**ï¼šæå–å›¾åƒä¸­çš„è¾¹ç¼˜ç‰¹å¾

```typescript
// OpenCV Cannyè¾¹ç¼˜æ£€æµ‹
cv.Canny(grayFrame, edges, threshold1, threshold2)

// å‚æ•°è¯´æ˜ï¼š
// threshold1 = 35  (ä½é˜ˆå€¼ï¼Œä¿ç•™å¼±è¾¹ç¼˜)
// threshold2 = 110 (é«˜é˜ˆå€¼ï¼Œå¼ºè¾¹ç¼˜)
```

**Cannyç®—æ³•æ­¥éª¤**ï¼š

1. **é«˜æ–¯æ»¤æ³¢**ï¼šå»é™¤å™ªå£°
2. **æ¢¯åº¦è®¡ç®—**ï¼šSobelç®—å­è®¡ç®—è¾¹ç¼˜å¼ºåº¦
3. **éæå¤§å€¼æŠ‘åˆ¶**ï¼šç»†åŒ–è¾¹ç¼˜
4. **åŒé˜ˆå€¼æ£€æµ‹**ï¼š
   - `> threshold2` â†’ å¼ºè¾¹ç¼˜ï¼ˆä¿ç•™ï¼‰
   - `< threshold1` â†’ å¼±è¾¹ç¼˜ï¼ˆä¸¢å¼ƒï¼‰
   - `threshold1 ~ threshold2` â†’ è¿æ¥åˆ°å¼ºè¾¹ç¼˜åˆ™ä¿ç•™

**è¾“å‡º**ï¼šäºŒå€¼åŒ–è¾¹ç¼˜å›¾ï¼ˆè¾¹ç¼˜=255ï¼Œéè¾¹ç¼˜=0ï¼‰

### Step 2: è½®å»“æ£€æµ‹

**ç›®çš„**ï¼šä»è¾¹ç¼˜å›¾ä¸­æå–è¿ç»­çš„è½®å»“

```typescript
// æ£€æµ‹è½®å»“
cv.findContours(
  edges,                      // è¾“å…¥è¾¹ç¼˜å›¾
  contours,                   // è¾“å‡ºè½®å»“é›†åˆ
  hierarchy,                  // è½®å»“å±‚çº§å…³ç³»
  cv.RETR_TREE,              // æ£€æµ‹æ¨¡å¼ï¼šå®Œæ•´å±‚çº§
  cv.CHAIN_APPROX_SIMPLE     // è¿‘ä¼¼æ–¹æ³•ï¼šä»…ä¿ç•™ç«¯ç‚¹
)
```

**æ¨¡å¼è¯´æ˜**ï¼š
- `RETR_TREE`ï¼šæ£€æµ‹æ‰€æœ‰è½®å»“ï¼Œä¿ç•™å±‚çº§å…³ç³»
- `CHAIN_APPROX_SIMPLE`ï¼šå‹ç¼©æ°´å¹³/å‚ç›´/å¯¹è§’çº¿æ®µï¼ŒèŠ‚çœå†…å­˜

**è¾“å‡º**ï¼šè½®å»“é›†åˆï¼ˆæ¯ä¸ªè½®å»“æ˜¯ä¸€ç³»åˆ—è¿ç»­ç‚¹ï¼‰

### Step 3: è½®å»“ç­›é€‰

**ç›®çš„**ï¼šè¿‡æ»¤å‡ºå¯èƒ½æ˜¯å±å¹•è¾¹ç•Œçš„è½®å»“

#### 3.1 é¢ç§¯è¿‡æ»¤

```typescript
const area = cv.contourArea(contour)

if (area < minContourArea) {  // é»˜è®¤ 1200pxÂ²
  continue  // å¿½ç•¥å°è½®å»“
}
```

**åŸç†**ï¼š
- å±å¹•è¾¹ç•Œè½®å»“é¢ç§¯è¾ƒå¤§
- å°è½®å»“ï¼ˆå™ªå£°ã€ç»†èŠ‚ï¼‰ä¸å¯èƒ½æ˜¯å±å¹•

**é¢ç§¯é˜ˆå€¼**ï¼š1200pxÂ² â‰ˆ 35Ã—35åƒç´ çš„æ­£æ–¹å½¢

#### 3.2 å¤šè¾¹å½¢è¿‘ä¼¼

```typescript
// å¤šè¾¹å½¢è¿‘ä¼¼
const arcLength = cv.arcLength(contour, true)
cv.approxPolyDP(
  contour,                    // è¾“å…¥è½®å»“
  approx,                     // è¾“å‡ºè¿‘ä¼¼å¤šè¾¹å½¢
  0.02 * arcLength,          // ç²¾åº¦ï¼šå‘¨é•¿çš„2%
  true                        // é—­åˆæ›²çº¿
)
```

**Douglas-Peuckerç®—æ³•**ï¼š
- ç”¨æ›´å°‘çš„ç‚¹è¿‘ä¼¼åŸå§‹è½®å»“
- ç²¾åº¦å‚æ•°ï¼šå‘¨é•¿çš„2%ï¼ˆå¹³æ»‘ä½†ä¿ç•™å½¢çŠ¶ï¼‰

**è¾“å‡º**ï¼šç®€åŒ–çš„å¤šè¾¹å½¢ï¼ˆé¡¶ç‚¹æ•°é‡å‡å°‘ï¼‰

#### 3.3 å››è¾¹å½¢åˆ¤å®š

```typescript
if (approx.rows === 4) {
  // æ˜¯å››è¾¹å½¢ï¼Œå¯èƒ½æ˜¯å±å¹•
  if (isRectangleShape(approx)) {
    screenLikeContours++
  }
}
```

**åŸç†**ï¼š
- å±å¹•è½®å»“ç»è¿‡è¿‘ä¼¼ååº”è¯¥æ˜¯4ä¸ªé¡¶ç‚¹
- ä¸‰è§’å½¢ã€äº”è¾¹å½¢ç­‰æ’é™¤

### Step 4: çŸ©å½¢éªŒè¯

**ç›®çš„**ï¼šç¡®è®¤å››è¾¹å½¢æ˜¯å¦æ¥è¿‘çŸ©å½¢

```typescript
function isRectangleShape(contour: any): boolean {
  // 1. æå–4ä¸ªé¡¶ç‚¹åæ ‡
  const points = extractPoints(contour)  // 4ä¸ªç‚¹
  
  // 2. è®¡ç®—4æ¡è¾¹çš„é•¿åº¦
  const distances = []
  for (let i = 0; i < 4; i++) {
    const p1 = points[i]
    const p2 = points[(i + 1) % 4]
    const dist = sqrt((p2.x - p1.x)Â² + (p2.y - p1.y)Â²)
    distances.push(dist)
  }
  
  // 3. æ£€æŸ¥å¯¹è¾¹é•¿åº¦æ˜¯å¦æ¥è¿‘
  // distances = [top, right, bottom, left]
  const topBottomMatch = 
    |distances[0] - distances[2]| < max(distances[0], distances[2]) * 0.2
  
  const leftRightMatch = 
    |distances[1] - distances[3]| < max(distances[1], distances[3]) * 0.2
  
  // 4. åˆ¤å®šï¼šä¸¤ç»„å¯¹è¾¹éƒ½åŒ¹é…
  return topBottomMatch && leftRightMatch
}
```

**çŸ©å½¢ç‰¹æ€§**ï¼š
- å¯¹è¾¹ç›¸ç­‰ï¼ˆå…è®¸Â±20%è¯¯å·®ï¼‰
- 4ä¸ªé¡¶ç‚¹
- é—­åˆå›¾å½¢

**å®¹é”™è®¾è®¡**ï¼š
- å…è®¸20%è¯¯å·®ï¼ˆåº”å¯¹é€è§†å˜å½¢ï¼‰
- å±å¹•æ‹æ‘„è§’åº¦ä¸å®Œå…¨å‚ç›´æ—¶ä»èƒ½æ£€æµ‹

**ç¤ºä¾‹**ï¼š

```
ç†æƒ³çŸ©å½¢ï¼š              é€è§†å˜å½¢ï¼ˆä»å¯æ£€æµ‹ï¼‰ï¼š
top: 100px              top: 100px
bottom: 100px           bottom: 85px  â† 15%å·®å¼‚ âœ“
left: 80px              left: 80px
right: 80px             right: 70px   â† 12.5%å·®å¼‚ âœ“

å¯¹è¾¹åŒ¹é… âœ“              å¯¹è¾¹åŒ¹é… âœ“ï¼ˆåœ¨20%å†…ï¼‰
```

### Step 5: ç½®ä¿¡åº¦è®¡ç®—

**ç›®çš„**ï¼šé‡åŒ–å±å¹•æ£€æµ‹çš„å¯ä¿¡åº¦

#### 5.1 è½®å»“ç½®ä¿¡åº¦

```typescript
// æ£€æµ‹åˆ°çš„çŸ©å½¢è½®å»“æ•°é‡
const contourConfidence = Math.min(contourCount, 1.0)

// è§£é‡Šï¼š
// 0ä¸ªè½®å»“ â†’ 0.0
// 1ä¸ªè½®å»“ â†’ 1.0
// 2ä¸ªä»¥ä¸Š â†’ 1.0 (é¥±å’Œ)
```

#### 5.2 è¾¹ç•Œå æ¯”ç½®ä¿¡åº¦

```typescript
const screenBoundaryRatio = totalScreenBoundaryArea / imageArea

const boundaryConfidence = Math.min(
  screenBoundaryRatio / screenBoundaryRatioThreshold,  // é»˜è®¤0.25
  1.0
)

// è§£é‡Šï¼š
// ratio < 0.25  â†’ confidence < 1.0
// ratio >= 0.25 â†’ confidence = 1.0 (é¥±å’Œ)
```

**å±å¹•è¾¹ç•Œå æ¯”**ï¼š

```
å°å±å¹•ï¼ˆæ‰‹æœºè¿œè·ç¦»æ‹æ‘„ï¼‰ï¼š   å¤§å±å¹•ï¼ˆè¿‘è·ç¦»æ‹æ‘„ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚         â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”Œâ”€â”€â”€â”€â”         â”‚         â”‚â”‚               â”‚â”‚
â”‚  â”‚ğŸ“± â”‚ 10%      â”‚         â”‚â”‚   ğŸ“±          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”˜         â”‚         â”‚â”‚     80%       â”‚â”‚
â”‚                 â”‚         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ä½ç½®ä¿¡åº¦                      é«˜ç½®ä¿¡åº¦
```

#### 5.3 ç»¼åˆç½®ä¿¡åº¦

```typescript
// åŠ æƒèåˆ
confidence = contourConfidence * 0.7 + boundaryConfidence * 0.3

// é™åˆ¶åœ¨[0, 1]èŒƒå›´
confidence = Math.min(confidence, 1.0)
```

**æƒé‡è®¾è®¡**ï¼š
- **è½®å»“æ•°é‡ï¼ˆ70%ï¼‰**ï¼šä¸»è¦æŒ‡æ ‡ï¼ˆæ˜¯å¦æœ‰çŸ©å½¢è½®å»“ï¼‰
- **è¾¹ç•Œå æ¯”ï¼ˆ30%ï¼‰**ï¼šè¾…åŠ©æŒ‡æ ‡ï¼ˆå±å¹•å¤§å°ï¼‰

**åˆ¤å®šé˜ˆå€¼**ï¼š
```typescript
if (confidence >= 0.75) {
  isScreenCapture = true  // âš ï¸ æ£€æµ‹åˆ°å±å¹•
}
```

**é˜ˆå€¼è¯´æ˜**ï¼š
- `0.75`ï¼šä¸¥æ ¼æ¨¡å¼ï¼Œä»…å½“éå¸¸ç¡®å®šæ—¶æ‰åˆ¤å®šä¸ºå±å¹•
- é™ä½è¯¯æŠ¥ç‡ï¼ˆå‡é˜³æ€§ï¼‰
- å¯èƒ½å¢åŠ æ¼æŠ¥ç‡ï¼ˆå‡é˜´æ€§ï¼‰

---

## å‚æ•°é…ç½®

### å®Œæ•´é…ç½®æ¥å£

```typescript
interface ScreenCornersContourDetectorOptions {
  // Canny è¾¹ç¼˜æ£€æµ‹å‚æ•°
  edgeThreshold1?: number              // ä½é˜ˆå€¼ï¼Œé»˜è®¤ 35
  edgeThreshold2?: number              // é«˜é˜ˆå€¼ï¼Œé»˜è®¤ 110
  
  // è½®å»“æ£€æµ‹å‚æ•°
  minContourArea?: number              // æœ€å°è½®å»“é¢ç§¯ï¼Œé»˜è®¤ 1200
  
  // ç»¼åˆåˆ¤æ–­å‚æ•°
  screenConfidenceThreshold?: number   // ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œé»˜è®¤ 0.75
  screenBoundaryRatioThreshold?: number // è¾¹ç•Œå æ¯”é˜ˆå€¼ï¼Œé»˜è®¤ 0.25
}
```

### å‚æ•°è°ƒä¼˜æŒ‡å—

#### 1. Cannyè¾¹ç¼˜æ£€æµ‹å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è°ƒæ•´ç­–ç•¥ | å½±å“ |
|------|--------|---------|------|
| `edgeThreshold1` | 35 | é™ä½â†’æ›´å¤šè¾¹ç¼˜<br>æé«˜â†’æ›´å°‘è¾¹ç¼˜ | è¿‡ä½ï¼šå™ªå£°å¢å¤š<br>è¿‡é«˜ï¼šæ¼æ£€è¾¹ç¼˜ |
| `edgeThreshold2` | 110 | é™ä½â†’æ›´å¤šå¼±è¾¹ç¼˜<br>æé«˜â†’ä»…å¼ºè¾¹ç¼˜ | è¿‡ä½ï¼šè¯¯æ£€å¢å¤š<br>è¿‡é«˜ï¼šæ¼æ£€å±å¹• |

**æ¨èæ¯”ä¾‹**ï¼š`threshold2 / threshold1 â‰ˆ 2-3`

**åœºæ™¯è°ƒæ•´**ï¼š
```typescript
// é«˜å¯¹æ¯”åº¦åœºæ™¯ï¼ˆå±å¹•ä¸èƒŒæ™¯å·®å¼‚å¤§ï¼‰
edgeThreshold1: 50
edgeThreshold2: 150

// ä½å¯¹æ¯”åº¦åœºæ™¯ï¼ˆå±å¹•ä¸èƒŒæ™¯æ¥è¿‘ï¼‰
edgeThreshold1: 25
edgeThreshold2: 80
```

#### 2. è½®å»“é¢ç§¯é˜ˆå€¼

| å‚æ•° | é»˜è®¤å€¼ | è°ƒæ•´ç­–ç•¥ | å½±å“ |
|------|--------|---------|------|
| `minContourArea` | 1200 | é™ä½â†’æ£€æµ‹æ›´å°å±å¹•<br>æé«˜â†’ä»…æ£€æµ‹å¤§å±å¹• | è¿‡ä½ï¼šå°å™ªå£°è¯¯æ£€<br>è¿‡é«˜ï¼šå°å±å¹•æ¼æ£€ |

**é¢ç§¯ä¼°ç®—**ï¼š

```
640Ã—480å›¾åƒï¼š
  - å…¨å±å æ¯” = 307,200 pxÂ²
  - 1/2å±å¹• = 153,600 pxÂ²
  - 1/4å±å¹• = 76,800 pxÂ²
  - æœ€å°æ£€æµ‹ï¼ˆé»˜è®¤1200ï¼‰ â‰ˆ 1/256å±å¹•

å»ºè®®èŒƒå›´ï¼š800-2000 pxÂ²
```

**åœºæ™¯è°ƒæ•´**ï¼š
```typescript
// æ£€æµ‹è¿œè·ç¦»å°å±å¹•ï¼ˆæ‰‹æœºï¼‰
minContourArea: 800

// æ£€æµ‹è¿‘è·ç¦»å¤§å±å¹•ï¼ˆæ˜¾ç¤ºå™¨ï¼‰
minContourArea: 2000
```

#### 3. ç½®ä¿¡åº¦é˜ˆå€¼

| å‚æ•° | é»˜è®¤å€¼ | è°ƒæ•´ç­–ç•¥ | å½±å“ |
|------|--------|---------|------|
| `screenConfidenceThreshold` | 0.75 | é™ä½â†’æ›´æ˜“æ£€å‡º<br>æé«˜â†’æ›´ä¸¥æ ¼ | è¿‡ä½ï¼šå‡é˜³æ€§â†‘<br>è¿‡é«˜ï¼šå‡é˜´æ€§â†‘ |
| `screenBoundaryRatioThreshold` | 0.25 | é™ä½â†’å°å±å¹•é€šè¿‡<br>æé«˜â†’ä»…å¤§å±å¹• | è¿‡ä½ï¼šå™ªå£°è¯¯åˆ¤<br>è¿‡é«˜ï¼šå°å±å¹•æ¼æ£€ |

**é˜ˆå€¼å¯¹æ¯”**ï¼š

| æ¨¡å¼ | confidence | boundaryRatio | é€‚ç”¨åœºæ™¯ |
|------|-----------|---------------|---------|
| ä¸¥æ ¼ | 0.80 | 0.30 | é‡‘è/å®‰å…¨è®¤è¯ |
| æ ‡å‡† | 0.75 | 0.25 | é€šç”¨åœºæ™¯ï¼ˆé»˜è®¤ï¼‰|
| å®½æ¾ | 0.65 | 0.20 | å®éªŒ/è°ƒè¯• |

### é»˜è®¤é…ç½®ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰

```typescript
const DEFAULT_OPTIONS = {
  // Cannyè¾¹ç¼˜æ£€æµ‹
  edgeThreshold1: 35,
  edgeThreshold2: 110,
  
  // è½®å»“æ£€æµ‹
  minContourArea: 1200,
  
  // åˆ¤å®šé˜ˆå€¼ï¼ˆä¸¥æ ¼ï¼‰
  screenConfidenceThreshold: 0.75,    // 75%ç½®ä¿¡åº¦
  screenBoundaryRatioThreshold: 0.25  // å±å¹•å æ¯”â‰¥25%
}
```

---

## æ€§èƒ½ç‰¹æ€§

### æ‰§è¡Œæ—¶é—´

```
æ“ä½œ                    è€—æ—¶          å æ¯”
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cannyè¾¹ç¼˜æ£€æµ‹           ~5-8ms        40%
è½®å»“æ£€æµ‹                ~3-5ms        25%
è½®å»“ç­›é€‰ä¸éªŒè¯          ~4-6ms        30%
ç½®ä¿¡åº¦è®¡ç®—              ~0.5-1ms      5%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡ï¼ˆ640Ã—480ï¼‰         ~12-20ms      100%
```

**åˆ†è¾¨ç‡å½±å“**ï¼š

| åˆ†è¾¨ç‡ | æ‰§è¡Œæ—¶é—´ | å¤‡æ³¨ |
|--------|---------|------|
| 320Ã—240 | ~5-8ms | å¿«é€Ÿå¤„ç† |
| 640Ã—480 | ~12-20ms | æ ‡å‡†é…ç½® â­ |
| 1280Ã—720 | ~30-45ms | é«˜æ¸…å¤„ç† |
| 1920Ã—1080 | ~60-90ms | è®¡ç®—å¯†é›† |

### å†…å­˜å ç”¨

```
ç»„ä»¶                    å†…å­˜å ç”¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
edges Mat              ~300KB (640Ã—480)
contours               ~50-100KB (åŠ¨æ€)
ä¸´æ—¶Matå¯¹è±¡            ~50KB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡                   ~400-450KB
```

**æ³¨æ„**ï¼šæ‰€æœ‰ä¸´æ—¶Matå¯¹è±¡åœ¨æ£€æµ‹åè‡ªåŠ¨æ¸…ç†

### ç²¾å‡†åº¦è¯„ä¼°

```
åœºæ™¯ç±»å‹              ç²¾å‡†åº¦      å‡é˜³æ€§    å‡é˜´æ€§
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ‰‹æœºå±å¹•ï¼ˆæ­£é¢ï¼‰      95%+        <2%       5%
æ‰‹æœºå±å¹•ï¼ˆæ–œè§’ï¼‰      85-90%      <3%       10-15%
å¹³æ¿å±å¹•              90%+        <2%       8%
æ˜¾ç¤ºå™¨å±å¹•            80-85%      <3%       15-20%
çœŸå®äººè„¸              98%+        2%        N/A
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

**å½±å“å› ç´ **ï¼š
- âœ… é«˜å¯¹æ¯”åº¦ï¼ˆå±å¹•ä¸èƒŒæ™¯å·®å¼‚å¤§ï¼‰â†’ ç²¾å‡†åº¦é«˜
- âœ… æ­£é¢æ‹æ‘„ï¼ˆçŸ©å½¢ä¸å˜å½¢ï¼‰â†’ ç²¾å‡†åº¦é«˜
- âŒ ä½å¯¹æ¯”åº¦ï¼ˆå±å¹•ä¸èƒŒæ™¯ç›¸ä¼¼ï¼‰â†’ æ¼æ£€
- âŒ å¤§è§’åº¦æ‹æ‘„ï¼ˆé€è§†ä¸¥é‡ï¼‰â†’ æ¼æ£€
- âŒ å±å¹•å æ¯”è¿‡å°ï¼ˆè¿œè·ç¦»ï¼‰â†’ æ¼æ£€

---

## é›†æˆæŒ‡å—

### åŸºç¡€ç”¨æ³•

```typescript
import { ScreenCornersContourDetector } from './screen-corners-contour-detector'

// 1. åˆå§‹åŒ–æ£€æµ‹å™¨
const detector = new ScreenCornersContourDetector({
  edgeThreshold1: 35,
  edgeThreshold2: 110,
  minContourArea: 1200,
  screenConfidenceThreshold: 0.75,
  screenBoundaryRatioThreshold: 0.25
})

// 2. è®¾ç½®OpenCVå®ä¾‹
detector.setCVInstance(cv)

// 3. æ‰§è¡Œæ£€æµ‹
const canvas = document.getElementById('canvas')
const ctx = canvas.getContext('2d')
ctx.drawImage(video, 0, 0, width, height)

// è½¬æ¢ä¸ºç°åº¦å›¾
const src = cv.imread(canvas)
const gray = new cv.Mat()
cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY)

// æ£€æµ‹
const result = detector.detect(gray)

// 4. å¤„ç†ç»“æœ
if (result.isScreenCapture) {
  console.warn(`âš ï¸ æ£€æµ‹åˆ°å±å¹•æ‹æ‘„ï¼`)
  console.warn(`ç½®ä¿¡åº¦ï¼š${(result.confidence * 100).toFixed(1)}%`)
  console.warn(`çŸ©å½¢è½®å»“æ•°ï¼š${result.contourCount}`)
  console.warn(`å±å¹•å æ¯”ï¼š${(result.screenBoundaryRatio * 100).toFixed(1)}%`)
  console.warn(`å¤„ç†è€—æ—¶ï¼š${result.processingTimeMs.toFixed(1)}ms`)
  
  // æ‹’ç»è®¤è¯
  alert('æ£€æµ‹åˆ°å±å¹•æ‹æ‘„æ”»å‡»ï¼')
} else {
  console.log('âœ… æœªæ£€æµ‹åˆ°å±å¹•è¾¹ç•Œ')
  console.log(`ç½®ä¿¡åº¦ï¼š${(result.confidence * 100).toFixed(1)}%`)
  console.log(`æ¶ˆæ¯ï¼š${detector.getMessage(result.confidence)}`)
}

// 5. æ¸…ç†èµ„æº
gray.delete()
src.delete()
```

### å¯è§†åŒ–è°ƒè¯•

```typescript
// å¯è§†åŒ–è¾¹ç¼˜å’Œè½®å»“ï¼ˆè°ƒè¯•ç”¨ï¼‰
function visualizeDetection(grayFrame: any) {
  const edges = new cv.Mat()
  const contours = new cv.MatVector()
  const hierarchy = new cv.Mat()
  
  // è¾¹ç¼˜æ£€æµ‹
  cv.Canny(grayFrame, edges, 35, 110)
  
  // è½®å»“æ£€æµ‹
  cv.findContours(edges, contours, hierarchy, cv.RETR_TREE, cv.CHAIN_APPROX_SIMPLE)
  
  // ç»˜åˆ¶è½®å»“
  const output = cv.Mat.zeros(grayFrame.rows, grayFrame.cols, cv.CV_8UC3)
  for (let i = 0; i < contours.size(); i++) {
    const color = new cv.Scalar(
      Math.random() * 255,
      Math.random() * 255,
      Math.random() * 255
    )
    cv.drawContours(output, contours, i, color, 2, cv.LINE_8, hierarchy, 0)
  }
  
  // æ˜¾ç¤ºåˆ°canvas
  cv.imshow('debugCanvas', output)
  
  // æ¸…ç†
  edges.delete()
  contours.delete()
  hierarchy.delete()
  output.delete()
}
```

### æ€§èƒ½ä¼˜åŒ–

**1. é™ä½åˆ†è¾¨ç‡**

```typescript
// åœ¨æ£€æµ‹å‰ç¼©æ”¾å›¾åƒ
const scale = 0.5
const smallWidth = Math.round(width * scale)
const smallHeight = Math.round(height * scale)

const small = new cv.Mat()
cv.resize(gray, small, new cv.Size(smallWidth, smallHeight))

// ä½¿ç”¨ç¼©æ”¾åçš„å›¾åƒæ£€æµ‹
const result = detector.detect(small)
small.delete()
```

**2. ROIåŒºåŸŸæ£€æµ‹**

```typescript
// ä»…æ£€æµ‹ä¸­å¿ƒåŒºåŸŸï¼ˆå‡è®¾å±å¹•åœ¨ä¸­å¿ƒï¼‰
const centerX = gray.cols / 4
const centerY = gray.rows / 4
const roiWidth = gray.cols / 2
const roiHeight = gray.rows / 2

const roi = gray.roi(new cv.Rect(centerX, centerY, roiWidth, roiHeight))
const result = detector.detect(roi)
roi.delete()
```

**3. é—´éš”æ£€æµ‹**

```typescript
// è§†é¢‘æµä¸­æ¯Nå¸§æ£€æµ‹ä¸€æ¬¡
let frameCount = 0
const DETECTION_INTERVAL = 30  // æ¯30å¸§æ£€æµ‹ä¸€æ¬¡

video.addEventListener('play', () => {
  const processFrame = () => {
    frameCount++
    
    if (frameCount % DETECTION_INTERVAL === 0) {
      // æ‰§è¡Œæ£€æµ‹
      const result = detector.detect(gray)
      if (result.isScreenCapture) {
        video.pause()
        alert('æ£€æµ‹åˆ°å±å¹•æ‹æ‘„ï¼')
      }
    }
    
    requestAnimationFrame(processFrame)
  }
  processFrame()
})
```

### ä¸å…¶ä»–æ£€æµ‹å™¨ç»„åˆ

```typescript
import { ScreenCornersContourDetector } from './screen-corners-contour-detector'
import { ScreenCaptureDetector } from './screen-capture-detector'
import { MotionLivenessDetector } from './motion-liveness-detector'

// å¤šå±‚æ£€æµ‹ç­–ç•¥
const contourDetector = new ScreenCornersContourDetector()
const screenDetector = new ScreenCaptureDetector(30)
const motionDetector = new MotionLivenessDetector()

// 1. å¿«é€Ÿè½®å»“æ£€æµ‹ï¼ˆå•å¸§ï¼Œæœ€å¿«ï¼‰
const contourResult = contourDetector.detect(gray)
if (contourResult.isScreenCapture) {
  return { pass: false, reason: 'Screen boundary detected' }
}

// 2. è§†é¢‘æ—¶åºæ£€æµ‹ï¼ˆ15-20å¸§ï¼Œä¸­ç­‰é€Ÿåº¦ï¼‰
if (screenDetector.isReady()) {
  const screenResult = screenDetector.detect(false, true)
  if (screenResult.isScreenCapture) {
    return { pass: false, reason: 'Screen capture detected' }
  }
}

// 3. è¿åŠ¨æ£€æµ‹ï¼ˆ5-10å¸§ï¼ŒéªŒè¯æ´»ä½“ï¼‰
const motionResult = motionDetector.analyzeMotion(gray, face, bbox)
if (!motionResult.isLively) {
  return { pass: false, reason: 'No liveness motion' }
}

return { pass: true }
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ£€æµ‹åˆ°çœŸå®åœºæ™¯ä¸ºå±å¹•ï¼ˆå‡é˜³æ€§ï¼‰ï¼Ÿ

**ç­”**ï¼šå‡é˜³æ€§é€šå¸¸æ¥è‡ªï¼š

1. **èƒŒæ™¯æœ‰çŸ©å½¢ç‰©ä½“**
   - é—¨æ¡†ã€çª—æˆ·ã€ç”»æ¡†ç­‰
   - è§£å†³ï¼šæé«˜`minContourArea`é˜ˆå€¼

2. **å›¾ç‰‡è¾¹ç¼˜**
   - å¦‚æœå›¾ç‰‡æœ¬èº«æ˜¯è£å‰ªçš„çŸ©å½¢
   - è§£å†³ï¼šæ£€æµ‹æ—¶æ’é™¤å›¾åƒè¾¹ç¼˜è½®å»“

3. **å‚æ•°è¿‡äºæ•æ„Ÿ**
   ```typescript
   // æé«˜é˜ˆå€¼
   detector = new ScreenCornersContourDetector({
     screenConfidenceThreshold: 0.80,  // ä»0.75æé«˜
     minContourArea: 1500              // ä»1200æé«˜
   })
   ```

### Q2: æ— æ³•æ£€æµ‹åˆ°æ˜æ˜¾çš„å±å¹•ï¼ˆå‡é˜´æ€§ï¼‰ï¼Ÿ

**ç­”**ï¼šå‡é˜´æ€§é€šå¸¸æ¥è‡ªï¼š

1. **ä½å¯¹æ¯”åº¦**
   - å±å¹•ä¸èƒŒæ™¯é¢œè‰²æ¥è¿‘
   - è§£å†³ï¼šé™ä½Cannyé˜ˆå€¼
   ```typescript
   edgeThreshold1: 25,  // ä»35é™ä½
   edgeThreshold2: 80   // ä»110é™ä½
   ```

2. **å±å¹•å æ¯”å¤ªå°**
   - è¿œè·ç¦»æ‹æ‘„ï¼Œå±å¹•å¾ˆå°
   - è§£å†³ï¼šé™ä½`minContourArea`
   ```typescript
   minContourArea: 800  // ä»1200é™ä½
   ```

3. **å¤§è§’åº¦æ‹æ‘„**
   - é€è§†å˜å½¢ä¸¥é‡ï¼ŒçŸ©å½¢å˜æˆæ¢¯å½¢
   - è§£å†³ï¼šå¢åŠ `isRectangleShape`çš„å®¹é”™ç‡
   ```typescript
   // å…è®¸30%è¯¯å·®ï¼ˆè€Œé20%ï¼‰
   Math.abs(d1 - d2) < Math.max(d1, d2) * 0.3
   ```

4. **å±å¹•è¾¹æ¡†ä¸æ˜æ˜¾**
   - æŸäº›æ‰‹æœºä½¿ç”¨å…¨é¢å±ï¼Œè¾¹æ¡†å¾ˆçª„
   - è§£å†³ï¼šç»“åˆå…¶ä»–æ£€æµ‹æ–¹æ³•

### Q3: æ£€æµ‹é€Ÿåº¦æ…¢æ€ä¹ˆåŠï¼Ÿ

**ç­”**ï¼šä¼˜åŒ–ç­–ç•¥ï¼š

1. **é™ä½åˆ†è¾¨ç‡**
   ```typescript
   cv.resize(gray, small, new cv.Size(320, 240))
   detector.detect(small)  // ~5-8ms
   ```

2. **ROIæ£€æµ‹**
   ```typescript
   // ä»…æ£€æµ‹ä¸­å¿ƒ50%åŒºåŸŸ
   const roi = gray.roi(new cv.Rect(w/4, h/4, w/2, h/2))
   ```

3. **å‡å°‘è½®å»“å¤„ç†**
   ```typescript
   // æé«˜minContourAreaï¼Œå‡å°‘éœ€è¦å¤„ç†çš„è½®å»“
   minContourArea: 2000  // ä»1200æé«˜
   ```

### Q4: å¦‚ä½•è°ƒæ•´å‚æ•°ä»¥é€‚åº”ä¸åŒåœºæ™¯ï¼Ÿ

**ç­”**ï¼šåœºæ™¯åŒ–å‚æ•°æ¨èï¼š

**åœºæ™¯1ï¼šç§»åŠ¨åº”ç”¨ï¼ˆæ‰‹æœºæ‘„åƒå¤´ï¼‰**
```typescript
{
  edgeThreshold1: 30,
  edgeThreshold2: 100,
  minContourArea: 1000,
  screenConfidenceThreshold: 0.75,
  screenBoundaryRatioThreshold: 0.20
}
```

**åœºæ™¯2ï¼šWebåº”ç”¨ï¼ˆç”µè„‘æ‘„åƒå¤´ï¼‰**
```typescript
{
  edgeThreshold1: 35,
  edgeThreshold2: 110,
  minContourArea: 1200,
  screenConfidenceThreshold: 0.75,
  screenBoundaryRatioThreshold: 0.25
}
```

**åœºæ™¯3ï¼šé«˜å®‰å…¨æ€§ï¼ˆé‡‘èåº”ç”¨ï¼‰**
```typescript
{
  edgeThreshold1: 40,
  edgeThreshold2: 120,
  minContourArea: 1500,
  screenConfidenceThreshold: 0.80,  // æ›´ä¸¥æ ¼
  screenBoundaryRatioThreshold: 0.30
}
```

**åœºæ™¯4ï¼šè°ƒè¯•/å®éªŒ**
```typescript
{
  edgeThreshold1: 25,
  edgeThreshold2: 80,
  minContourArea: 800,
  screenConfidenceThreshold: 0.60,  // æ›´å®½æ¾
  screenBoundaryRatioThreshold: 0.15
}
```

### Q5: è½®å»“æ£€æµ‹ä¸å…¶ä»–å±å¹•æ£€æµ‹æ–¹æ³•çš„åŒºåˆ«ï¼Ÿ

**ç­”**ï¼šå¯¹æ¯”åˆ†æï¼š

| æ–¹æ³• | åŸç† | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|------|---------|
| **è½®å»“æ£€æµ‹** | æ£€æµ‹çŸ©å½¢è¾¹ç•Œ | å¿«é€Ÿã€ç›´è§‚ | è§’åº¦æ•æ„Ÿ | å¿«é€Ÿåˆç­› |
| **é—ªçƒæ£€æµ‹** | æ£€æµ‹åˆ·æ–°ç‡ | é«˜ç²¾å‡†åº¦ | éœ€è¦å¤šå¸§ | LCD/OLEDå± |
| **å“åº”æ—¶é—´** | æ£€æµ‹åƒç´ å»¶è¿Ÿ | å¢¨æ°´å±ç‰¹æ•ˆ | éœ€è¦å¤šå¸§ | å¢¨æ°´å± |
| **DLPè‰²è½®** | æ£€æµ‹RGBåˆ†ç¦» | DLPç‰¹æ•ˆ | éœ€è¦å¤šå¸§ | DLPæŠ•å½± |
| **å…‰å­¦ç•¸å˜** | æ£€æµ‹å¤±çœŸ | æŠ•å½±ç‰¹æ•ˆ | è®¡ç®—å¯†é›† | æŠ•å½±ä»ª |

**æ¨èç»„åˆ**ï¼š
1. **å¿«é€Ÿæ¨¡å¼**ï¼šè½®å»“æ£€æµ‹ï¼ˆå•å¸§ï¼‰
2. **æ ‡å‡†æ¨¡å¼**ï¼šè½®å»“æ£€æµ‹ + é—ªçƒæ£€æµ‹
3. **ä¸¥æ ¼æ¨¡å¼**ï¼šè½®å»“æ£€æµ‹ + å…¨éƒ¨è§†é¢‘æ—¶åºæ£€æµ‹

### Q6: ä¸ºä»€ä¹ˆè¦ç”¨70%/30%çš„æƒé‡åˆ†é…ï¼Ÿ

**ç­”**ï¼šæƒé‡è®¾è®¡ç†ç”±ï¼š

**è½®å»“æ•°é‡ï¼ˆ70%ï¼‰- ä¸»è¦æŒ‡æ ‡**ï¼š
- æ˜¯å¦æ£€æµ‹åˆ°çŸ©å½¢è½®å»“æ˜¯å…³é”®ç‰¹å¾
- 1ä¸ªæ¸…æ™°çš„çŸ©å½¢è½®å»“å·²è¶³ä»¥åˆ¤å®šä¸ºå±å¹•
- å¯¹çœŸå®åœºæ™¯çš„æ’é™¤èƒ½åŠ›å¼º

**è¾¹ç•Œå æ¯”ï¼ˆ30%ï¼‰- è¾…åŠ©æŒ‡æ ‡**ï¼š
- å±å¹•å¤§å°æä¾›é¢å¤–ä¿¡æ¯
- ä½†å°å±å¹•ä¹Ÿå¯èƒ½æ˜¯æ”»å‡»ï¼ˆè¿œè·ç¦»æ‹æ‘„ï¼‰
- é¿å…å› å±å¹•å°è€Œæ¼æ£€

**å®éªŒéªŒè¯**ï¼š
```
æƒé‡æ–¹æ¡ˆæµ‹è¯•ï¼ˆ100å¼ æ ·æœ¬ï¼‰ï¼š

50/50åˆ†é…ï¼š   å‡é˜³æ€§3%  å‡é˜´æ€§12%
60/40åˆ†é…ï¼š   å‡é˜³æ€§2%  å‡é˜´æ€§9%
70/30åˆ†é…ï¼š   å‡é˜³æ€§2%  å‡é˜´æ€§7%   â† æœ€ä½³
80/20åˆ†é…ï¼š   å‡é˜³æ€§1%  å‡é˜´æ€§10%
```

### Q7: é€è§†å˜å½¢ä¸¥é‡æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ

**ç­”**ï¼šé€è§†çŸ«æ­£ç­–ç•¥ï¼š

```typescript
// 1. æ£€æµ‹åˆ°å››è¾¹å½¢åè¿›è¡Œé€è§†å˜æ¢
function correctPerspective(contour: any, image: any) {
  // æå–4ä¸ªè§’ç‚¹
  const points = extractCorners(contour)
  
  // ç›®æ ‡çŸ©å½¢ï¼ˆæ ‡å‡†æ­£é¢ï¼‰
  const width = 640
  const height = 480
  const dstPoints = [
    [0, 0],
    [width, 0],
    [width, height],
    [0, height]
  ]
  
  // è®¡ç®—é€è§†å˜æ¢çŸ©é˜µ
  const M = cv.getPerspectiveTransform(points, dstPoints)
  
  // åº”ç”¨å˜æ¢
  const corrected = new cv.Mat()
  cv.warpPerspective(image, corrected, M, new cv.Size(width, height))
  
  return corrected
}

// 2. åœ¨çŸ«æ­£åçš„å›¾åƒä¸Šé‡æ–°æ£€æµ‹
const corrected = correctPerspective(contour, gray)
const result = detector.detect(corrected)
```

**æ³¨æ„**ï¼šé€è§†çŸ«æ­£å¢åŠ è®¡ç®—å¼€é”€ï¼Œä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨

### Q8: å¦‚ä½•æµ‹è¯•æ£€æµ‹å™¨çš„æ•ˆæœï¼Ÿ

**ç­”**ï¼šæµ‹è¯•æµç¨‹ï¼š

**1. å‡†å¤‡æµ‹è¯•é›†**
```
æ­£æ ·æœ¬ï¼ˆçœŸå®äººè„¸ï¼‰ï¼š100å¼ 
  - ä¸åŒå…‰ç…§ï¼š50å¼ 
  - ä¸åŒèƒŒæ™¯ï¼š30å¼ 
  - ä¸åŒè§’åº¦ï¼š20å¼ 

è´Ÿæ ·æœ¬ï¼ˆå±å¹•æ‹æ‘„ï¼‰ï¼š100å¼ 
  - æ‰‹æœºå±å¹•ï¼š40å¼ 
  - å¹³æ¿å±å¹•ï¼š30å¼ 
  - æ˜¾ç¤ºå™¨å±å¹•ï¼š20å¼ 
  - æŠ•å½±å±å¹•ï¼š10å¼ 
```

**2. æ‰¹é‡æµ‹è¯•**
```typescript
function batchTest(images: string[], labels: boolean[]) {
  let truePositive = 0
  let falsePositive = 0
  let trueNegative = 0
  let falseNegative = 0
  
  for (let i = 0; i < images.length; i++) {
    const img = cv.imread(images[i])
    const gray = new cv.Mat()
    cv.cvtColor(img, gray, cv.COLOR_RGBA2GRAY)
    
    const result = detector.detect(gray)
    const isScreen = result.isScreenCapture
    const actualScreen = labels[i]
    
    if (isScreen && actualScreen) truePositive++
    if (isScreen && !actualScreen) falsePositive++
    if (!isScreen && !actualScreen) trueNegative++
    if (!isScreen && actualScreen) falseNegative++
    
    gray.delete()
    img.delete()
  }
  
  const precision = truePositive / (truePositive + falsePositive)
  const recall = truePositive / (truePositive + falseNegative)
  const accuracy = (truePositive + trueNegative) / images.length
  
  console.log(`Precision: ${(precision * 100).toFixed(2)}%`)
  console.log(`Recall: ${(recall * 100).toFixed(2)}%`)
  console.log(`Accuracy: ${(accuracy * 100).toFixed(2)}%`)
}
```

**3. å‚æ•°è°ƒä¼˜**
```typescript
// ç½‘æ ¼æœç´¢æœ€ä½³å‚æ•°
const thresholds = [0.65, 0.70, 0.75, 0.80, 0.85]
const areas = [800, 1000, 1200, 1500, 2000]

let bestAccuracy = 0
let bestParams = {}

for (const threshold of thresholds) {
  for (const area of areas) {
    const detector = new ScreenCornersContourDetector({
      screenConfidenceThreshold: threshold,
      minContourArea: area
    })
    
    const accuracy = testDetector(detector, testImages, testLabels)
    
    if (accuracy > bestAccuracy) {
      bestAccuracy = accuracy
      bestParams = { threshold, area }
    }
  }
}

console.log('Best params:', bestParams)
console.log('Best accuracy:', bestAccuracy)
```

---

## æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å¿«é€Ÿæ£€æµ‹**ï¼šå•å¸§å¤„ç†ï¼Œ~10-20msï¼Œé€‚åˆå®æ—¶åœºæ™¯
2. **ç›´è§‚ç‰¹å¾**ï¼šåŸºäºå±å¹•ç‰©ç†è¾¹ç•Œï¼ˆçŸ©å½¢è½®å»“ï¼‰
3. **ä¸¥æ ¼åˆ¤å®š**ï¼šç½®ä¿¡åº¦>0.75ï¼Œå±å¹•å æ¯”>25%ï¼Œé™ä½è¯¯æŠ¥
4. **è½»é‡å®ç°**ï¼šä»…éœ€OpenCVï¼Œæ— é¢å¤–ä¾èµ–
5. **äº’è¡¥æ€§å¼º**ï¼šå¯ä½œä¸ºå¿«é€Ÿåˆç­›ï¼Œä¸è§†é¢‘æ—¶åºæ£€æµ‹ç»„åˆ

### æ¨èé…ç½®

```typescript
// é€šç”¨æ¨èé…ç½®
const detector = new ScreenCornersContourDetector({
  edgeThreshold1: 35,                    // Cannyä½é˜ˆå€¼
  edgeThreshold2: 110,                   // Cannyé«˜é˜ˆå€¼
  minContourArea: 1200,                  // æœ€å°è½®å»“é¢ç§¯
  screenConfidenceThreshold: 0.75,       // ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆä¸¥æ ¼ï¼‰
  screenBoundaryRatioThreshold: 0.25     // å±å¹•å æ¯”é˜ˆå€¼
})
```

### é€‚ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èåº¦ | è¯´æ˜ |
|------|--------|------|
| å¿«é€Ÿåˆç­› | â­â­â­â­â­ | å•å¸§å¿«é€Ÿæ£€æµ‹ï¼Œæå‰æ’é™¤æ˜æ˜¾æ”»å‡» |
| ç§»åŠ¨åº”ç”¨ | â­â­â­â­ | å®æ—¶æ€§å¥½ï¼Œä½è®¡ç®—å¼€é”€ |
| Webåº”ç”¨ | â­â­â­â­ | æµè§ˆå™¨å†…è¿è¡Œï¼Œæ— æ€§èƒ½é—®é¢˜ |
| ç»„åˆæ£€æµ‹ | â­â­â­â­â­ | ä¸è§†é¢‘æ—¶åºæ£€æµ‹ç»„åˆæ•ˆæœæœ€ä½³ |
| ç‹¬ç«‹ä½¿ç”¨ | â­â­â­ | å¯ç”¨ä½†å»ºè®®ç»„åˆå…¶ä»–æ–¹æ³• |

### ä¸‹ä¸€æ­¥

- ä¸è§†é¢‘æ—¶åºæ£€æµ‹å™¨ç»„åˆï¼Œæ„å»ºå¤šå±‚é˜²å¾¡
- æ ¹æ®å®é™…åœºæ™¯è°ƒä¼˜å‚æ•°
- æ”¶é›†çœŸå®æ”»å‡»æ ·æœ¬è¿›è¡Œæµ‹è¯•
- è€ƒè™‘æ·»åŠ é€è§†çŸ«æ­£åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
