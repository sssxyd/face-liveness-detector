<div align="center">

> **è¯­è¨€ / Languages:** [ä¸­æ–‡](#) Â· [English](./README.en.md)

# äººè„¸æ´»ä½“æ£€æµ‹å¼•æ“

<p>
  <strong>åŸºäº TensorFlow + OpenCV çš„çº¯å‰ç«¯å®æ—¶äººè„¸æ´»ä½“æ£€æµ‹è§£å†³æ–¹æ¡ˆ</strong>
</p>

<p>
  <img alt="TypeScript" src="https://img.shields.io/badge/TypeScript-5.0+-3178c6?logo=typescript">
  <img alt="NPM Package" src="https://img.shields.io/npm/v/@sssxyd/face-liveness-detector?label=npm&color=cb3837">
  <img alt="License" src="https://img.shields.io/badge/license-MIT-green">
</p>

</div>

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

<table>
  <tr>
    <td>ğŸ’¯ <strong>çº¯å‰ç«¯å®ç°</strong><br/>é›¶åç«¯ä¾èµ–ï¼Œæ‰€æœ‰å¤„ç†åœ¨æµè§ˆå™¨ä¸­æœ¬åœ°è¿è¡Œ</td>
    <td>ğŸ”¬ <strong>æ··åˆ AI æ–¹æ¡ˆ</strong><br/>TensorFlow + OpenCV æ·±åº¦èåˆ</td>
  </tr>
  <tr>
    <td>ğŸ§  <strong>åŒé‡æ´»ä½“éªŒè¯</strong><br/>é™é»˜æ£€æµ‹ + åŠ¨ä½œè¯†åˆ«ï¼ˆçœ¨çœ¼ã€å¼ å˜´ã€æŠ¬å¤´ã€ç‚¹å¤´ï¼‰</td>
    <td>âš¡ <strong>äº‹ä»¶é©±åŠ¨æ¶æ„</strong><br/>100% TypeScriptï¼Œä¸ä»»ä½•æ¡†æ¶æ— ç¼é›†æˆ</td>
  </tr>
  <tr>
    <td>ğŸ¯ <strong>å…¨ç»´åº¦åˆ†æ</strong><br/>è´¨é‡ã€æ­£å¯¹åº¦ã€è¿åŠ¨åˆ†æ•°</td>
    <td>ğŸ›¡ï¸ <strong>å¤šç»´åæ¬ºéª—</strong><br/>ç…§ç‰‡è¿åŠ¨æ£€æµ‹ã€å‡ ä½•ç‰¹å¾åˆ†æ</td>
  </tr>
</table>

---

## ğŸš€ åœ¨çº¿æ¼”ç¤º

<div align="center">

**[ğŸ‘‰ å®æ—¶ä½“éªŒæ¼”ç¤º](https://face.lowtechsoft.com/) | ç”¨æ‰‹æœºæ‰«ç å¿«é€Ÿæµ‹è¯•**

[![äººè„¸æ´»ä½“æ£€æµ‹æ¼”ç¤ºäºŒç»´ç ](https://raw.githubusercontent.com/sssxyd/face-liveness-detector/main/demos/vue-demo/vue-demo.png)](https://face.lowtechsoft.com/)

</div>

---

## ğŸ§¬ æ ¸å¿ƒç®—æ³•è®¾è®¡

| æ£€æµ‹æ¨¡å— | æŠ€æœ¯æ–¹æ¡ˆ | è¯´æ˜æ–‡æ¡£ |
|---------|--------|--------|
| **äººè„¸è¯†åˆ«** | Human.js BlazeFace + FaceMesh | 468ä¸ªé¢éƒ¨ç‰¹å¾ç‚¹ + è¡¨æƒ…è¯†åˆ« |
| **äººè„¸è¿åŠ¨æ£€æµ‹** | å…³é”®ç‚¹è¿åŠ¨åˆ†æ | [äººè„¸è¿åŠ¨æ£€æµ‹ç®—æ³•](./docs/FaceMovingDetectorAlgorithm.md) - åŸºäºä¸­å¿ƒåŒ–å¤„ç†å’Œå¸§é—´ä½ç§»è®¡ç®—ï¼Œæ£€æµ‹ç”¨æˆ·å¤´éƒ¨è¿åŠ¨ |
| **ç…§ç‰‡æ”»å‡»æ£€æµ‹** | å‡ ä½•ç‰¹å¾åˆ†æ | [ç…§ç‰‡æ”»å‡»æ£€æµ‹ç®—æ³•](./docs/PhotoAttackDetectorAlgorithm.md) - é€è§†ä¸€è‡´æ€§ã€ä½ç§»æ–¹å·®ã€è¿åŠ¨ä¸€è‡´æ€§åˆ†æ |
| **åŠ¨ä½œæ´»ä½“æ£€æµ‹** | Human.js Gesture æ¨¡å— | [åŠ¨ä½œæ£€æµ‹ç®—æ³•](./docs/FaceLivenessDetectionAlgorithm.md) - çœ¨çœ¼ã€å¼ å˜´ã€ç‚¹å¤´ã€æŠ¬å¤´ç­‰éšæœºåŠ¨ä½œéªŒè¯ |

---

## ğŸ“¦ å®‰è£…æŒ‡å—

### å¿«é€Ÿå®‰è£…ï¼ˆ3 ä¸ªåŒ…ï¼‰

```
npm install @sssxyd/face-liveness-detector @vladmandic/human @techstark/opencv-js
```

<details>
<summary><strong>å…¶ä»–åŒ…ç®¡ç†å™¨</strong></summary>

```bash
# Yarn
yarn add @sssxyd/face-liveness-detector @vladmandic/human @techstark/opencv-js

# pnpm
pnpm add @sssxyd/face-liveness-detector @vladmandic/human @techstark/opencv-js
```

</details>

> ğŸ“ **ä¸ºä»€ä¹ˆéœ€è¦ä¸‰ä¸ªåŒ…ï¼Ÿ**
> `@vladmandic/human` å’Œ `@techstark/opencv-js` æ˜¯å¯¹ç­‰ä¾èµ–ï¼ˆpeer dependenciesï¼‰ï¼Œéœ€è¦å•ç‹¬å®‰è£…ä»¥é¿å…æ†ç»‘å¤§å‹åº“ï¼Œå‡å°æœ€ç»ˆçš„æ‰“åŒ…ä½“ç§¯ã€‚

---

## âš ï¸ å¿…è¦é…ç½®æ­¥éª¤

### 1ï¸âƒ£ ä¿®å¤ OpenCV.js ESM å…¼å®¹æ€§é—®é¢˜

`@techstark/opencv-js` åŒ…å«ä¸å…¼å®¹çš„ UMD æ ¼å¼ï¼Œ**å¿…é¡»åº”ç”¨è¡¥ä¸è„šæœ¬**ã€‚

**å‚è€ƒï¼š**
- é—®é¢˜è¯¦æƒ…ï¼š[TechStark/opencv-js#44](https://github.com/TechStark/opencv-js/issues/44)
- è¡¥ä¸è„šæœ¬ï¼š[patch-opencv.js](https://github.com/sssxyd/face-liveness-detector/tree/main/demos/vue-demo/scripts/patch-opencv.js)

**è®¾ç½®æ–¹æ³•ï¼ˆæ¨èï¼‰ï¼š** æ·»åŠ åˆ° `package.json` çš„ `postinstall` é’©å­

```
{
  "scripts": {
    "postinstall": "node patch-opencv.cjs"
  }
}
```

### 2ï¸âƒ£ ä¸‹è½½ Human.js æ¨¡å‹æ–‡ä»¶

`@vladmandic/human` éœ€è¦æ¨¡å‹æ–‡ä»¶å’Œ TensorFlow WASM åç«¯ï¼Œ**å¦åˆ™æ— æ³•åŠ è½½**ã€‚

**ä¸‹è½½è„šæœ¬ï¼š**
- æ¨¡å‹å¤åˆ¶ï¼š[copy-models.js](https://github.com/sssxyd/face-liveness-detector/tree/main/demos/vue-demo/scripts/copy-models.js)
- WASM ä¸‹è½½ï¼š[download-wasm.js](https://github.com/sssxyd/face-liveness-detector/tree/main/demos/vue-demo/scripts/download-wasm.js)

**è®¾ç½®æ–¹æ³•ï¼ˆæ¨èï¼‰ï¼š** é…ç½®ä¸º `postinstall` é’©å­

```
{
  "scripts": {
    "postinstall": "node scripts/copy-models.js && node scripts/download-wasm.js"
  }
}
```

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç¤ºä¾‹

```
import FaceDetectionEngine, { LivenessAction } from '@sssxyd/face-liveness-detector'

// åˆå§‹åŒ–å¼•æ“
const engine = new FaceDetectionEngine({
  // èµ„æºè·¯å¾„é…ç½®
  human_model_path: '/models',
  tensorflow_wasm_path: '/wasm',

  // æ‘„åƒå¤´åˆ†è¾¨ç‡è®¾ç½®, é»˜è®¤1280x720ï¼Œé™ä½ä¸º640x480å¯æå‡é€Ÿåº¦ï¼Œç¨å¾®é™ä½ç²¾åº¦
  detect_video_ideal_width: 1280,
  detect_video_ideal_height: 720,

  // åŠ¨ä½œæ´»ä½“æ£€æµ‹è®¾ç½®
  action_liveness_action_count: 1,     // éœ€è¦è¢«æ£€æµ‹è€…æ‰§è¡Œçš„åŠ¨ä½œæ•°é‡ï¼Œå–å€¼èŒƒå›´[0-4], 0è¡¨ç¤ºä¸è¿›è¡ŒåŠ¨ä½œæ´»ä½“æ£€æµ‹ï¼Œéœ€è¦é«˜å¯é æ€§æ—¶å»ºè®®è®¾ç½®ä¸º2
  action_liveness_verify_timeoutï¼š15000, // æ¯ä¸ªåŠ¨ä½œæ£€æµ‹çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤15000msï¼Œå»ºè®®ä¸è¦ä½äº1000ms

  // ç…§ç‰‡æ”»å‡»æ£€æµ‹è®¾ç½®
  photo_attack_passed_frame_count: 10, // è¿ç»­Xå¸§é€šè¿‡ç…§ç‰‡æ”»å‡»æ£€æµ‹ï¼Œæ‰æœ€ç»ˆé‡‡ä¿¡ï¼Œé»˜è®¤15ï¼Œæœ€ä½ä¸åº”è¯¥ä½äº5ï¼Œæ•°å€¼è¶Šå°æ£€æµ‹é€Ÿåº¦è¶Šå¿«ï¼Œç²¾å‡†åº¦ä¹Ÿéšä¹‹é™ä½
})

// ç›‘å¬æ ¸å¿ƒäº‹ä»¶
engine.on('detector-loaded', (data) => {
  if (data.success) {
    console.log('âœ… å¼•æ“å°±ç»ª', {
      opencv: data.opencv_version,
      human: data.human_version
    })
  }
})

engine.on('detector-info', (data) => {
  // æ¯å¸§å®æ—¶æ•°æ®
  console.log({
    status: data.code,
    quality: (data.imageQuality * 100).toFixed(1) + '%',
    frontal: (data.faceFrontal * 100).toFixed(1) + '%',
    motion: (data.motionScore * 100).toFixed(1) + '%',
    screen: (data.screenConfidence * 100).toFixed(1) + '%'
  })
})

engine.on('detector-action', (data) => {
  // åŠ¨ä½œæç¤º
  console.log(`è¯·æ‰§è¡ŒåŠ¨ä½œ: ${data.action} (${data.status})`)
})

engine.on('detector-finish', (data) => {
  // æ£€æµ‹å®Œæˆ
  if (data.success) {
    console.log('âœ… æ´»ä½“éªŒè¯é€šè¿‡ï¼', {
      é™é»˜é€šè¿‡: data.silentPassedCount,
      åŠ¨ä½œå®Œæˆ: data.actionPassedCount,
      æœ€ä½³è´¨é‡: (data.bestQualityScore * 100).toFixed(1) + '%',
      æ€»è€—æ—¶: (data.totalTime / 1000).toFixed(2) + 's'
    })
  } else {
    console.log('âŒ æ´»ä½“éªŒè¯å¤±è´¥')
  }
})

engine.on('detector-error', (error) => {
  console.error(`âŒ é”™è¯¯ [${error.code}]: ${error.message}`)
})

// å¯åŠ¨æ£€æµ‹
async function startLivenessDetection() {
  try {
    // åˆå§‹åŒ–åº“
    await engine.initialize()
    
    // è·å–è§†é¢‘å…ƒç´ å¹¶å¼€å§‹æ£€æµ‹
    const videoEl = document.getElementById('video') as HTMLVideoElement
    await engine.startDetection(videoEl)
    
    // æ£€æµ‹è‡ªåŠ¨è¿è¡Œåˆ°å®Œæˆæˆ–æ‰‹åŠ¨åœæ­¢
    // engine.stopDetection(true)  // åœæ­¢å¹¶æ˜¾ç¤ºæœ€ä½³å›¾åƒ
  } catch (error) {
    console.error('æ£€æµ‹å¯åŠ¨å¤±è´¥:', error)
  }
}

// å°±ç»ªæ—¶å¯åŠ¨
startLivenessDetection()
```

---

## âš™ï¸ è¯¦ç»†é…ç½®å‚è€ƒ

### èµ„æºè·¯å¾„é…ç½®

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `human_model_path` | `string` | Human.js æ¨¡å‹æ–‡ä»¶ç›®å½• | `undefined` |
| `tensorflow_wasm_path` | `string` | TensorFlow WASM æ–‡ä»¶ç›®å½• | `undefined` |
| `tensorflow_backend` | `'auto' \| 'webgl' \| 'wasm'` | TensorFlow åç«¯å¼•æ“ | `'auto'` |

### è°ƒè¯•æ¨¡å¼é…ç½®

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `debug_mode` | `boolean` | å¯ç”¨è°ƒè¯•æ¨¡å¼ | `false` |
| `debug_log_level` | `'info' \| 'warn' \| 'error'` | è°ƒè¯•æ—¥å¿—æœ€ä½çº§åˆ« | `'info'` |
| `debug_log_stages` | `string[]` | è°ƒè¯•æ—¥å¿—é˜¶æ®µè¿‡æ»¤ï¼ˆundefined=å…¨éƒ¨ï¼‰ | `undefined` |
| `debug_log_throttle` | `number` | è°ƒè¯•æ—¥å¿—èŠ‚æµé—´éš”ï¼ˆmsï¼‰ | `100` |

### æ£€æµ‹åŠŸèƒ½é…ç½®

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `enable_face_moving_detection` | `boolean` | å¯ç”¨äººè„¸è¿åŠ¨æ£€æµ‹ | `true` |
| `enable_photo_attack_detection` | `boolean` | å¯ç”¨ç…§ç‰‡æ”»å‡»æ£€æµ‹ | `true` |

### è§†é¢‘æ£€æµ‹è®¾ç½®

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `detect_video_ideal_width` | `number` | è§†é¢‘å®½åº¦ï¼ˆåƒç´ ï¼‰ | `1280` |
| `detect_video_ideal_height` | `number` | è§†é¢‘é«˜åº¦ï¼ˆåƒç´ ï¼‰ | `720` |
| `detect_video_mirror` | `boolean` | æ°´å¹³ç¿»è½¬è§†é¢‘ | `true` |
| `detect_video_load_timeout` | `number` | åŠ è½½è¶…æ—¶ï¼ˆmsï¼‰ | `5000` |

### äººè„¸é‡‡é›†è´¨é‡è¦æ±‚

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `collect_min_collect_count` | `number` | æœ€å°‘é‡‡é›†æ•°é‡ | `3` |
| `collect_min_face_ratio` | `number` | æœ€å°äººè„¸å æ¯” (0-1) | `0.5` |
| `collect_max_face_ratio` | `number` | æœ€å¤§äººè„¸å æ¯” (0-1) | `0.9` |
| `collect_min_face_frontal` | `number` | æœ€å°æ­£å¯¹åº¦ (0-1) | `0.9` |
| `collect_min_image_quality` | `number` | æœ€å°å›¾åƒè´¨é‡ (0-1) | `0.5` |

### äººè„¸æ­£å¯¹åº¦å‚æ•°

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `yaw_threshold` | `number` | åèˆªè§’é˜ˆå€¼ï¼ˆåº¦ï¼‰ | `3` |
| `pitch_threshold` | `number` | ä¿¯ä»°è§’é˜ˆå€¼ï¼ˆåº¦ï¼‰ | `4` |
| `roll_threshold` | `number` | ç¿»æ»šè§’é˜ˆå€¼ï¼ˆåº¦ï¼‰ | `2` |

### å›¾åƒè´¨é‡å‚æ•°

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `require_full_face_in_bounds` | `boolean` | äººè„¸å®Œå…¨åœ¨è¾¹ç•Œå†… | `false` |
| `min_laplacian_variance` | `number` | æœ€å°æ‹‰æ™®æ‹‰æ–¯æ–¹å·®æ£€æµ‹å€¼ | `40` |
| `min_gradient_sharpness` | `number` | æœ€å°æ¢¯åº¦é”åº¦ | `0.15` |
| `min_blur_score` | `number` | æœ€å°æ¨¡ç³Šåˆ†æ•° | `0.6` |

### æ´»ä½“æ£€æµ‹è®¾ç½®

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `action_liveness_action_list` | `LivenessAction[]` | åŠ¨ä½œåˆ—è¡¨ | `[BLINK, MOUTH_OPEN, NOD_DOWN, NOD_UP]` |
| `action_liveness_action_count` | `number` | éœ€è¦å®Œæˆçš„åŠ¨ä½œæ•° | `1` |
| `action_liveness_action_randomize` | `boolean` | éšæœºåŒ–åŠ¨ä½œé¡ºåº | `true` |
| `action_liveness_verify_timeout` | `number` | å•ä¸€åŠ¨ä½œéªŒè¯è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ | `15000` |
| `action_liveness_min_mouth_open_percent` | `number` | æœ€å°å¼ å˜´æ¯”ä¾‹ (0-1) | `0.2` |

### ç…§ç‰‡æ”»å‡»æ£€æµ‹è®¾ç½®

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|------|--------|
| `photo_attack_passed_frame_count` | `number` | ç…§ç‰‡æ”»å‡»æ£€æµ‹é€šè¿‡æ‰€éœ€è¿ç»­æˆåŠŸå¸§æ•° | `15` |

> **æ³¨æ„**ï¼šç…§ç‰‡æ”»å‡»æ£€æµ‹ä½¿ç”¨å†…ç½®çš„å‡ ä½•ç‰¹å¾åˆ†æç®—æ³•ï¼ˆé€è§†æ¯”ç‡ã€ä½ç§»æ–¹å·®ã€æ–¹å‘ä¸€è‡´æ€§ã€ä»¿å°„å˜æ¢åŒ¹é…ï¼‰ï¼Œæ‰€æœ‰å‚æ•°å·²å†…ç½®ä¼˜åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚è¯¦è§[ç…§ç‰‡æ”»å‡»æ£€æµ‹ç®—æ³•æ–‡æ¡£](./docs/PHOTO_ATTACK_DETECTION_ALGORITHM.md)ã€‚

---

## ğŸ› ï¸ API æ–¹æ³•å‚è€ƒ

### æ ¸å¿ƒæ–¹æ³•

#### `initialize(): Promise<void>`
åŠ è½½å¹¶åˆå§‹åŒ–æ£€æµ‹åº“ã€‚**å¿…é¡»åœ¨ä½¿ç”¨å…¶ä»–åŠŸèƒ½å‰è°ƒç”¨ã€‚**

```
await engine.initialize()
```

#### `startDetection(videoElement): Promise<void>`
åœ¨è§†é¢‘å…ƒç´ ä¸Šå¼€å§‹äººè„¸æ£€æµ‹ã€‚

```
const videoEl = document.getElementById('video') as HTMLVideoElement
await engine.startDetection(videoEl)
```

#### `stopDetection(success?: boolean): void`
åœæ­¢æ£€æµ‹è¿‡ç¨‹ã€‚

```
engine.stopDetection(true)  // true: æ˜¾ç¤ºæœ€ä½³æ£€æµ‹å›¾åƒ
```

#### `updateConfig(config): void`
è¿è¡Œæ—¶åŠ¨æ€æ›´æ–°é…ç½®ã€‚

```
engine.updateConfig({
  collect_min_face_ratio: 0.6,
  action_liveness_action_count: 0
})
```

#### `getOptions(): FaceDetectionEngineOptions`
è·å–å½“å‰é…ç½®å¯¹è±¡ã€‚

```
const config = engine.getOptions()
```

#### `getEngineState(): EngineState`
è·å–å¼•æ“å½“å‰çŠ¶æ€ã€‚

```
const state = engine.getEngineState()
```

---

## ğŸ“¡ äº‹ä»¶ç³»ç»Ÿ

å¼•æ“é‡‡ç”¨ **TypeScript äº‹ä»¶å‘å°„å™¨æ¨¡å¼**ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½æ˜¯ç±»å‹å®‰å…¨çš„ã€‚

### äº‹ä»¶åˆ—è¡¨

<table>
<tr>
<td><strong>detector-loaded</strong></td>
<td>å¼•æ“åˆå§‹åŒ–å®Œæˆ</td>
</tr>
<tr>
<td><strong>detector-info</strong></td>
<td>æ¯å¸§å®æ—¶æ£€æµ‹æ•°æ®</td>
</tr>
<tr>
<td><strong>detector-action</strong></td>
<td>åŠ¨ä½œæ´»ä½“æç¤ºä¸çŠ¶æ€</td>
</tr>
<tr>
<td><strong>detector-finish</strong></td>
<td>æ£€æµ‹å®Œæˆï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰</td>
</tr>
<tr>
<td><strong>detector-error</strong></td>
<td>é”™è¯¯å‘ç”Ÿæ—¶è§¦å‘</td>
</tr>
<tr>
<td><strong>detector-debug</strong></td>
<td>è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘ç”¨ï¼‰</td>
</tr>
</table>

---

### ğŸ“‹ detector-loaded

**å¼•æ“åˆå§‹åŒ–å®Œæˆæ—¶è§¦å‘**

```
interface DetectorLoadedEventData {
  success: boolean        // åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ
  error?: string          // é”™è¯¯ä¿¡æ¯ï¼ˆå¤±è´¥æ—¶ï¼‰
  opencv_version?: string // OpenCV.js ç‰ˆæœ¬å·
  human_version?: string  // Human.js ç‰ˆæœ¬å·
}
```

**ç¤ºä¾‹ï¼š**
```
engine.on('detector-loaded', (data) => {
  if (data.success) {
    console.log('âœ… å¼•æ“å°±ç»ª')
    console.log(`OpenCV ${data.opencv_version} | Human.js ${data.human_version}`)
  } else {
    console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', data.error)
  }
})
```

---

### ğŸ“Š detector-info

**æ¯å¸§è¿”å›å®æ—¶æ£€æµ‹æ•°æ®ï¼ˆé«˜é¢‘äº‹ä»¶ï¼‰**

```
interface DetectorInfoEventData {
  passed: boolean         // æ˜¯å¦é€šè¿‡é™é»˜æ£€æµ‹
  code: DetectionCode     // æ£€æµ‹çŠ¶æ€ç 
  message: string         // çŠ¶æ€æ¶ˆæ¯
  faceCount: number       // æ£€æµ‹åˆ°çš„äººè„¸æ•°
  faceRatio: number       // äººè„¸å æ¯” (0-1)
  faceFrontal: number     // äººè„¸æ­£å¯¹åº¦ (0-1)
  imageQuality: number    // å›¾åƒè´¨é‡åˆ†æ•° (0-1)
  motionScore: number     // è¿åŠ¨åˆ†æ•° (0-1)
  keypointVariance: number // å…³é”®ç‚¹æ–¹å·® (0-1)
  motionType: string      // æ£€æµ‹åˆ°çš„è¿åŠ¨ç±»å‹
  screenConfidence: number // å±å¹•é‡‡é›†ç½®ä¿¡åº¦ (0-1)
}
```

**æ£€æµ‹çŠ¶æ€ç ï¼š**
```
enum DetectionCode {
  VIDEO_NO_FACE = 'VIDEO_NO_FACE',                // æœªæ£€æµ‹åˆ°äººè„¸
  MULTIPLE_FACE = 'MULTIPLE_FACE',                // æ£€æµ‹åˆ°å¤šå¼ äººè„¸
  FACE_TOO_SMALL = 'FACE_TOO_SMALL',              // äººè„¸å¤ªå°
  FACE_TOO_LARGE = 'FACE_TOO_LARGE',              // äººè„¸å¤ªå¤§
  FACE_NOT_FRONTAL = 'FACE_NOT_FRONTAL',          // äººè„¸ä¸å¤Ÿæ­£é¢
  FACE_LOW_QUALITY = 'FACE_LOW_QUALITY',          // å›¾åƒè´¨é‡è¿‡ä½
  FACE_IMAGE_CAPTURED = 'FACE_IMAGE_CAPTURED'     // å›¾ç‰‡è¢«é‡‡é›†
  PHOTO_ATTACK_DETECTED = "PHOTO_ATTACK_DETECTED" // ç…§ç‰‡æ”»å‡»æ£€æµ‹
}
```

**ç¤ºä¾‹ï¼š**
```
engine.on('detector-info', (data) => {
  console.log({
    æ£€æµ‹çŠ¶æ€: data.code,
    é™é»˜é€šè¿‡: data.passed ? 'âœ…' : 'âŒ',
    å›¾åƒè´¨é‡: `${(data.imageQuality * 100).toFixed(1)}%`,
    äººè„¸æ­£å¯¹åº¦: `${(data.faceFrontal * 100).toFixed(1)}%`,
  })
})
```

---

### ğŸ‘¤ detector-action

**åŠ¨ä½œæ´»ä½“æç¤ºä¸è¯†åˆ«çŠ¶æ€**

```
interface DetectorActionEventData {
  action: LivenessAction          // è¦æ‰§è¡Œçš„åŠ¨ä½œ
  status: LivenessActionStatus    // åŠ¨ä½œçŠ¶æ€
}

enum LivenessAction {
  BLINK = 'blink',           // çœ¨çœ¼
  MOUTH_OPEN = 'mouth_open', // å¼ å˜´
  NOD_DOWN = 'nod_down',     // ç‚¹å¤´
  NOD_UP = 'nod_up'          // æŠ¬å¤´
}

enum LivenessActionStatus {
  STARTED = 'started',      // æç¤ºå·²å¼€å§‹
  COMPLETED = 'completed',  // æˆåŠŸè¯†åˆ«
  TIMEOUT = 'timeout'       // è¯†åˆ«è¶…æ—¶
}
```

**ç¤ºä¾‹ï¼š**
```
engine.on('detector-action', (data) => {
  const actionLabels = {
    'blink': 'çœ¨çœ¼',
    'mouth_open': 'å¼ å˜´',
    'nod_down': 'ç‚¹å¤´',
    'nod_up': 'æŠ¬å¤´'
  }
  
  switch (data.status) {
    case 'started':
      console.log(`ğŸ‘¤ è¯·æ‰§è¡Œ: ${actionLabels[data.action]}`)
      // æ˜¾ç¤º UI æç¤º
      break
    case 'completed':
      console.log(`âœ… å·²è¯†åˆ«: ${actionLabels[data.action]}`)
      // æ›´æ–°è¿›åº¦æ¡
      break
    case 'timeout':
      console.log(`â±ï¸ è¶…æ—¶: ${actionLabels[data.action]}`)
      // æ˜¾ç¤ºé‡è¯•æç¤º
      break
  }
})
```

---

### âœ… detector-finish

**æ£€æµ‹æµç¨‹å®Œæˆï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰**

```
interface DetectorFinishEventData {
  success: boolean         // æ˜¯å¦é€šè¿‡éªŒè¯
  silentPassedCount: number    // é™é»˜æ£€æµ‹é€šè¿‡æ•°
  actionPassedCount: number    // åŠ¨ä½œå®Œæˆæ•°
  totalTime: number        // æ€»è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
  bestQualityScore: number // æœ€ä½³å›¾åƒè´¨é‡ (0-1)
  bestFrameImage: string | null  // Base64 å¸§å›¾åƒ
  bestFaceImage: string | null   // Base64 äººè„¸å›¾åƒ
}
```

**ç¤ºä¾‹ï¼š**
```
engine.on('detector-finish', (data) => {
  if (data.success) {
    console.log('ğŸ‰ æ´»ä½“éªŒè¯æˆåŠŸï¼', {
      é™é»˜é€šè¿‡: `${data.silentPassedCount} æ¬¡`,
      åŠ¨ä½œå®Œæˆ: `${data.actionPassedCount} æ¬¡`,
      æœ€ä½³è´¨é‡: `${(data.bestQualityScore * 100).toFixed(1)}%`,
      æ€»è€—æ—¶: `${(data.totalTime / 1000).toFixed(2)}s`
    })
    
    // ä¸Šä¼ ç»“æœåˆ°æœåŠ¡å™¨
    if (data.bestFrameImage) {
      uploadToServer({
        image: data.bestFrameImage,
        quality: data.bestQualityScore,
        timestamp: new Date()
      })
    }
  } else {
    console.log('âŒ éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•')
  }
})
```

---

### âš ï¸ detector-error

**æ£€æµ‹è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯**

```
interface DetectorErrorEventData {
  code: ErrorCode  // é”™è¯¯ä»£ç 
  message: string  // é”™è¯¯ä¿¡æ¯
}

enum ErrorCode {
  DETECTOR_NOT_INITIALIZED = 'DETECTOR_NOT_INITIALIZED',
  CAMERA_ACCESS_DENIED = 'CAMERA_ACCESS_DENIED',
  STREAM_ACQUISITION_FAILED = 'STREAM_ACQUISITION_FAILED',
  SUSPECTED_FRAUDS_DETECTED = 'SUSPECTED_FRAUDS_DETECTED'
}
```

**ç¤ºä¾‹ï¼š**
```
engine.on('detector-error', (error) => {
  const errorMessages: Record<string, string> = {
    'DETECTOR_NOT_INITIALIZED': 'å¼•æ“æœªåˆå§‹åŒ–',
    'CAMERA_ACCESS_DENIED': 'æ‘„åƒå¤´æƒé™è¢«æ‹’ç»',
    'STREAM_ACQUISITION_FAILED': 'æ— æ³•è·å–æ‘„åƒå¤´æ•°æ®æµ',
    'SUSPECTED_FRAUDS_DETECTED': 'æ£€æµ‹åˆ°æ¬ºéª—è¡Œä¸º'
  }
  
  console.error(`âŒ é”™è¯¯ [${error.code}]: ${errorMessages[error.code] || error.message}`)
  showUserErrorPrompt(errorMessages[error.code])
})
```

---

### ğŸ› detector-debug

**å¼€å‘å’Œæ•…éšœæ’é™¤çš„è°ƒè¯•ä¿¡æ¯**

```
interface DetectorDebugEventData {
  level: 'info' | 'warn' | 'error'  // æ—¥å¿—çº§åˆ«
  stage: string                      // å¤„ç†é˜¶æ®µ
  message: string                    // è°ƒè¯•ä¿¡æ¯
  details?: Record<string, any>      // é¢å¤–è¯¦æƒ…
  timestamp: number                  // Unix æ—¶é—´æˆ³
}
```

**ç¤ºä¾‹ï¼š**
```
engine.on('detector-debug', (debug) => {
  const time = new Date(debug.timestamp).toLocaleTimeString()
  const prefix = `[${time}] [${debug.stage}]`
  
  if (debug.level === 'error') {
    console.error(`${prefix} âŒ ${debug.message}`, debug.details)
  } else {
    console.log(`${prefix} â„¹ï¸ ${debug.message}`)
  }
})
```

---

## ğŸ“– ç±»å‹å®šä¹‰

### LivenessAction
```
enum LivenessAction {
  BLINK = 'blink',           // çœ¨çœ¼
  MOUTH_OPEN = 'mouth_open', // å¼ å˜´
  NOD_DOWN = 'nod_down',     // ç‚¹å¤´
  NOD_UP = 'nod_up'          // æŠ¬å¤´
}
```

### LivenessActionStatus
```
enum LivenessActionStatus {
  STARTED = 'started',      // åŠ¨ä½œæç¤ºå·²å¼€å§‹
  COMPLETED = 'completed',  // åŠ¨ä½œæˆåŠŸè¯†åˆ«
  TIMEOUT = 'timeout'       // åŠ¨ä½œè¯†åˆ«è¶…æ—¶
}
```

### DetectionCode
```
enum DetectionCode {
  VIDEO_NO_FACE = 'VIDEO_NO_FACE',                  // è§†é¢‘ä¸­æœªæ£€æµ‹åˆ°äººè„¸
  MULTIPLE_FACE = 'MULTIPLE_FACE',                  // æ£€æµ‹åˆ°å¤šå¼ äººè„¸
  FACE_TOO_SMALL = 'FACE_TOO_SMALL',                // äººè„¸å°ºå¯¸å°äºæœ€å°é˜ˆå€¼
  FACE_TOO_LARGE = 'FACE_TOO_LARGE',                // äººè„¸å°ºå¯¸å¤§äºæœ€å¤§é˜ˆå€¼
  FACE_NOT_FRONTAL = 'FACE_NOT_FRONTAL',            // äººè„¸è§’åº¦ä¸å¤Ÿæ­£é¢
  FACE_LOW_QUALITY = 'FACE_LOW_QUALITY',            // å›¾åƒè´¨é‡ä½äºæœ€å°å€¼
  FACE_IMAGE_CAPTURED = 'FACE_IMAGE_CAPTURED'       // äººè„¸å›¾åƒå·²é‡‡é›†
  FACE_NOT_MOVING = 'FACE_NOT_MOVING',              // äººè„¸æœªç§»åŠ¨ 
  PHOTO_ATTACK_DETECTED = 'PHOTO_ATTACK_DETECTED',  // å›¾ç‰‡æ”»å‡»æ£€æµ‹
}
```


### ErrorCode
```
enum ErrorCode {
  // æ£€æµ‹å™¨åˆå§‹åŒ–å¤±è´¥
  DETECTOR_NOT_INITIALIZED = 'DETECTOR_NOT_INITIALIZED',
  // æ‘„åƒå¤´è®¿é—®è¢«æ‹’ç»
  CAMERA_ACCESS_DENIED = 'CAMERA_ACCESS_DENIED',
  // è§†é¢‘æµè·å–å¤±è´¥
  STREAM_ACQUISITION_FAILED = 'STREAM_ACQUISITION_FAILED',
  // å†…éƒ¨é”™è¯¯
  INTERNAL_ERROR = 'INTERNAL_ERROR',
}
```

---

## ğŸ“ é«˜çº§ç”¨æ³•ä¸ç¤ºä¾‹

### å®Œæ•´çš„ Vue 3 æ¼”ç¤ºé¡¹ç›®

æœ‰å…³å…¨é¢çš„ç¤ºä¾‹å’Œé«˜çº§ä½¿ç”¨æ¨¡å¼ï¼Œè¯·å‚è€ƒå®˜æ–¹æ¼”ç¤ºé¡¹ç›®ï¼š

**[Vue æ¼”ç¤ºé¡¹ç›®](https://github.com/sssxyd/face-liveness-detector/tree/main/demos/vue-demo/)** åŒ…æ‹¬ï¼š

- âœ… å®Œæ•´çš„ Vue 3 + TypeScript é›†æˆ
- âœ… å®æ—¶æ£€æµ‹ç»“æœå¯è§†åŒ–
- âœ… åŠ¨æ€é…ç½®é¢æ¿
- âœ… æ‰€æœ‰å¼•æ“äº‹ä»¶çš„å®Œæ•´å¤„ç†
- âœ… å®æ—¶è°ƒè¯•é¢æ¿
- âœ… å“åº”å¼ç§»åŠ¨ç«¯ + æ¡Œé¢ç«¯ UI
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- âœ… ç»“æœå¯¼å‡ºå’Œå›¾åƒæ•è·

**å¿«é€Ÿå¯åŠ¨æ¼”ç¤ºï¼š**

```
cd demos/vue-demo
npm install
npm run dev
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ˜¾ç¤ºçš„æœ¬åœ° URLã€‚

---

## ğŸ“¥ æœ¬åœ°éƒ¨ç½²æ¨¡å‹æ–‡ä»¶

### ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°éƒ¨ç½²ï¼Ÿ

- ğŸš€ **æå‡æ€§èƒ½** - é¿å… CDN å»¶è¿Ÿ
- ğŸ”’ **éšç§ä¿æŠ¤** - å®Œå…¨ç¦»çº¿è¿è¡Œ
- ğŸŒ **ç½‘ç»œç‹¬ç«‹** - ä¸ä¾èµ–å¤–éƒ¨è¿æ¥

### å¯ç”¨è„šæœ¬

é¡¹ç›®æ ¹ç›®å½•æä¾›ä¸¤ä¸ªä¸‹è½½è„šæœ¬ï¼š

#### 1ï¸âƒ£ å¤åˆ¶ Human.js æ¨¡å‹

```
node copy-models.js
```

**åŠŸèƒ½ï¼š**
- ä» `node_modules/@vladmandic/human/models` å¤åˆ¶æ¨¡å‹
- ä¿å­˜åˆ° `public/models/` ç›®å½•
- åŒ…å« `.json` å’Œ `.bin` æ¨¡å‹æ–‡ä»¶
- è‡ªåŠ¨æ˜¾ç¤ºæ–‡ä»¶å¤§å°å’Œè¿›åº¦

#### 2ï¸âƒ£ ä¸‹è½½ TensorFlow WASM æ–‡ä»¶

```
node download-wasm.js
```

**åŠŸèƒ½ï¼š**
- è‡ªåŠ¨ä¸‹è½½ TensorFlow.js WASM åç«¯
- ä¿å­˜åˆ° `public/wasm/` ç›®å½•
- ä¸‹è½½ 4 ä¸ªå…³é”®æ–‡ä»¶ï¼š
  - `tf-backend-wasm.min.js`
  - `tfjs-backend-wasm.wasm`
  - `tfjs-backend-wasm-simd.wasm`
  - `tfjs-backend-wasm-threaded-simd.wasm`
- **æ™ºèƒ½å¤š CDN æº** è‡ªåŠ¨å›é€€ï¼š
  1. unpkg.comï¼ˆæ¨èï¼‰
  2. cdn.jsdelivr.net
  3. esm.sh
  4. cdn.esm.sh

### é…ç½®é¡¹ç›®ä½¿ç”¨æœ¬åœ°æ–‡ä»¶

ä¸‹è½½å®Œæˆåï¼Œåœ¨å¼•æ“åˆå§‹åŒ–æ—¶æŒ‡å®šæœ¬åœ°è·¯å¾„ï¼š

```
const engine = new FaceDetectionEngine({
  // ä½¿ç”¨æœ¬åœ°æ–‡ä»¶è€Œä¸æ˜¯ CDN
  human_model_path: '/models',
  tensorflow_wasm_path: '/wasm',
  
  // å…¶ä»–é…ç½®...
})
```

### è‡ªåŠ¨åŒ–è®¾ç½®ï¼ˆæ¨èï¼‰

åœ¨ `package.json` ä¸­é…ç½® `postinstall` é’©å­å®ç°è‡ªåŠ¨ä¸‹è½½ï¼š

```
{
  "scripts": {
    "postinstall": "node scripts/copy-models.js && node scripts/download-wasm.js"
  }
}
```

---

## ğŸŒ æµè§ˆå™¨å…¼å®¹æ€§

| æµè§ˆå™¨ | ç‰ˆæœ¬ | æ”¯æŒ | å¤‡æ³¨ |
|--------|------|------|------|
| Chrome | 60+ | âœ… | å®Œå…¨æ”¯æŒ |
| Firefox | 55+ | âœ… | å®Œå…¨æ”¯æŒ |
| Safari | 11+ | âœ… | å®Œå…¨æ”¯æŒ |
| Edge | 79+ | âœ… | å®Œå…¨æ”¯æŒ |

**ç³»ç»Ÿè¦æ±‚ï¼š**

- ğŸ“± æ”¯æŒ **WebRTC** çš„ç°ä»£æµè§ˆå™¨
- ğŸ”’ **HTTPS ç¯å¢ƒ**ï¼ˆå¼€å‘å¯ç”¨ localhostï¼‰
- âš™ï¸ **WebGL** æˆ– **WASM** åç«¯æ”¯æŒ
- ğŸ“¹ **ç”¨æˆ·æˆæƒ** - éœ€è¦æ‘„åƒå¤´æƒé™

---

## ğŸ“„ è®¸å¯è¯

[MIT License](./LICENSE) - è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

<div align="center">

**[â¬† è¿”å›é¡¶éƒ¨](#äººè„¸æ´»ä½“æ£€æµ‹å¼•æ“)**

Made with â¤ï¸ by [sssxyd](https://github.com/sssxyd)

</div>


